# Yes, there are certs and PRIVATE keys in here. These are for TESTING ONLY! If
#   you use this CA or private keys in a production environment and get Pwned,
#   it is your own fault! You have been warned!

class foremancerts (
  $sslDir         = '/var/lib/foreman/ssl',
  $owner          = 'foreman',
  $incForemanKey  = false,
  $incPuppetKey   = false,
  $incRootCAKey   = false,
  $incCRL         = true,
) {

  validate_absolute_path($sslDir)
  validate_re($owner, '^foreman(-proxy)?$', 'Invalid FormanCerts Owner')
  validate_bool($incForemanKey)
  validate_bool($incPuppetKey)
  validate_bool($incRootCAKey)
  validate_bool($incCRL)

  $foremanService = $owner

  $sslCertsDir = "$sslDir/certs"
  $sslPrivateKeysDir = "$sslDir/private_keys"

  anchor { 'ForemanCerts::BeforeSSL': }
  anchor { 'ForemanCerts::AfterSSL': }

  # Dirs
  exec { 'Ensure Dependant Dirs':
    command => "/bin/mkdir -p '${sslDir}'",
    creates => $sslDir,
  }
  file { 'Foreman SSL Dir':
    ensure  => directory,
    path    => $sslDir,
    owner   => $owner,
    group   => $owner,
    mode    => '0744',
    require => Exec['Ensure Dependant Dirs'],
  }
  file { 'Foreman SSL Certs Dir':
    ensure => directory,
    path   => $sslCertsDir,
    owner  => $owner,
    group  => $owner,
    mode   => '0744',
  }
  file { 'Foreman SSL PrivateKeyDir':
    ensure => directory,
    path   => $sslPrivateKeysDir,
    owner  => $owner,
    group  => $owner,
    mode   => '0744',
  }

  # Certs
  file { 'Foreman Cert':
    ensure  => file,
    path    => "${sslCertsDir}/foreman.example.net.pem",
    owner   => $owner,
    group   => $owner,
    mode    => '0644',
    content => join([
      '-----BEGIN CERTIFICATE-----',
      'MIIFzTCCA7WgAwIBAgIBATANBgkqhkiG9w0BAQsFADB5MQswCQYDVQQGEwJVUzET',
      'MBEGA1UECAwKV2FzaGluZ3RvbjEQMA4GA1UEBwwHU2VhdHRsZTEcMBoGA1UECgwT',
      'SnVuZ2xlIENhdCBTb2Z0d2FyZTElMCMGA1UEAwwcRXhhbXBsZSBGb3JlbWFuIFJv',
      'b3QgQ0EgQ2VydDAeFw0xNjA1MjgxNzAxMzhaFw0yNjA1MjYxNzAxMzhaMF4xCzAJ',
      'BgNVBAYTAlVTMRMwEQYDVQQIDApXYXNoaW5ndG9uMRwwGgYDVQQKDBNKdW5nbGUg',
      'Q2F0IFNvZnR3YXJlMRwwGgYDVQQDDBNmb3JlbWFuLmV4YW1wbGUubmV0MIICIjAN',
      'BgkqhkiG9w0BAQEFAAOCAg8AMIICCgKCAgEAt2Ph+5hIqW19kC/beo3LrfWYvWlP',
      'x5lsOFbDhRf/ikCU4ZJlm/RdG0cfd+speLzUyzqQ9AvLskimENZqw+hLzRxgbKR3',
      '5AzLU4ycRLYPGSqzL9njmvJiN8PcCdcUmNFnOk+wpMJLBOi1Km0F8yOB1dUtaL89',
      'ANlbgcONqM1IeVNJUTQ+78i8PTjtt+ev0j0ELsqGJxIKJpG1ZFRIlAO4ShpElqq5',
      '5xsigXvVA474lO9JTSnYBX5mvf2qRwG43CcyQ6qSmrVMxKJypLZ/ZcGmj1AnH0a1',
      '0c2qnnDBKQRYeTAIfld85HUqKBMBR3kwbt+wFoDgZK9tNrmGB24A0UwgVBWCPssQ',
      'gBEjmgGjvm7xavD+roNYmogQh1GXKXW+J0F0k5XAaD/ShxbRerHdOVpB5IfHR+TG',
      'UQA6NIU4gqZtv8IkWPqty5PLwu3JZiSJTH04bMcCUKPpUh2eouTyPlZShazU0VxR',
      'HJAHsJ+siAlrncKH9lGfvxSpInvHrvVZc6HVIv5WQO+QgOk0jbKqjIqZQlFx92EV',
      '5FzvRodyN+pGbQfTbgiZ8NI6AM9WbbFXdz4m46Im+JH8HZUDbMaq84wAMa+JUU+y',
      'O5wlLuErOncCBtMMAbRXSc5P3mT2LLZPEyv2U4fmU2vvpoS0nTtMrPmZYLnfI24N',
      'OPGM997pc9/Al2MCAwEAAaN7MHkwCQYDVR0TBAIwADAsBglghkgBhvhCAQ0EHxYd',
      'T3BlblNTTCBHZW5lcmF0ZWQgQ2VydGlmaWNhdGUwHQYDVR0OBBYEFD8lqyxjD7U0',
      'onwPD7dnF8tX0TYgMB8GA1UdIwQYMBaAFKchKslxPsqhFFkK40r3HQ/RwvRvMA0G',
      'CSqGSIb3DQEBCwUAA4ICAQA7bZwogOZZWSToMlpUtWnm0m9LlL443/bcwut7hDca',
      'nC/ZmUx0UgMrmysx3fQftYR1Xa92FposzHvg/UmwL62n5bBLtNf3l9rX25pnjD2u',
      '+5bE+4/I0iESbciwKFCB4dPsjKF3YGzc/sdjjjbJ5jOAbYH47T/GlUmDIylX6O4C',
      '4XLhMjUn2IYyJTrEAWYFIH8AO9W69P89JHAguqRDXpQaB35+KpIYO455K92KN0Wv',
      'HpU7NUQzMEzH5wTC7UK64+ffOZn9NRndtRF2yT0m3cRUutbFheVvKsas7hNCSe2F',
      'etT8yGUG3QaPfE5nrKAC/nRVYOeX28peHPAlJ2P6SArldrXCF0YChrXVpnaNHH23',
      'SRbbQ3CRKt2EWl/Zjo0Wd/3UncfTUTVbJjVtlrvjgL7WTsyY9xfN0NCaXFuHYanR',
      'Kyf37VSqJhNb+NMtwh0vzb2uD8B0G6VmSZaXt/d4GvGWxOIl9hm+W8Co/dW5jVJW',
      'rmE+Y6YenupZtYBdsX9+gsC47nN0nHeb+1c/Z5l1jxeb6+ID3J8+IWDdaf35J8iP',
      '2H/k1+8DPL5cqdY4TbS3qyVSD11ybSLRTz2OrNJMDVVppkpAoLv90K0ihjGIQ/O5',
      '5DtB6+hBOCNK/tQKSlDihtprJqQZFAkmrNg2R3W88GQRkj10FJiIvp5lHXkQWd4P',
      'yQ==',
      '-----END CERTIFICATE-----',
      '',
    ], "\n"),
    tag     => 'SSLCert',
  }
  file { 'Puppet Cert':
    ensure  => file,
    path    => "${sslCertsDir}/puppet.example.net.pem",
    owner   => $owner,
    group   => $owner,
    mode    => '0644',
    content => join([
      '-----BEGIN CERTIFICATE-----',
      'MIIFzDCCA7SgAwIBAgIBAjANBgkqhkiG9w0BAQsFADB5MQswCQYDVQQGEwJVUzET',
      'MBEGA1UECAwKV2FzaGluZ3RvbjEQMA4GA1UEBwwHU2VhdHRsZTEcMBoGA1UECgwT',
      'SnVuZ2xlIENhdCBTb2Z0d2FyZTElMCMGA1UEAwwcRXhhbXBsZSBGb3JlbWFuIFJv',
      'b3QgQ0EgQ2VydDAeFw0xNjA1MjgxOTQ5MDBaFw0yNjA1MjYxOTQ5MDBaMF0xCzAJ',
      'BgNVBAYTAlVTMRMwEQYDVQQIDApXYXNoaW5ndG9uMRwwGgYDVQQKDBNKdW5nbGUg',
      'Q2F0IFNvZnR3YXJlMRswGQYDVQQDDBJwdXBwZXQuZXhhbXBsZS5uZXQwggIiMA0G',
      'CSqGSIb3DQEBAQUAA4ICDwAwggIKAoICAQCqIETmdpeshDVKVJ0xOqAod/2oWklQ',
      'g3rzYuD8tYbSaBZTFre23CDz4DVy9RHUhNw90YWlIVXO+e8Xq1vT16udcIzRa+uT',
      'Vg1T/NufoPgpdm46S3Xz0qBZGf+rEK9irRy1qCXaq55jBQJem4p9v4kZ/vK49Wd7',
      '6WLjDh0cnP3MN+DIhbsNHZJYklMB6iMWk0jpk8ZZRq1ce0H6b4eNnJgY27Q+4KBq',
      'OZZTzPfJR/dG9X0LymJVgDtv/ettQ+awift4XCdjmNByVTCD1OIiF2G3Hzy+0JWh',
      'qPegahDMA+/xorRMZu7PNUPAGYg/qsoac9wMNa917Sj5JMrS3iosVW+VypcaX5/v',
      'U8TOFAPgichGoalZcZaceK53M2NEoHqJ8qnsAaUkYM6bwTK0RNGOfd7C6Vg24D87',
      '950tiCklq9OrqVsZjJpEfdJV7WEwD6c6/kaT8WMn0mpj9Pyt7wHX3KERx14UZdkr',
      '/3pFArxyCprbAkviu21HddHRVatrESH4frun+tAxDjNZFaQdTfW8QdOkMHU9uDzM',
      '6+oNtpym3ZpZXMRLVfVoY1KhvQYrTfYoDrgmxRHLDJVAfvW6Qa8deMiZquOG5D7R',
      'PXs1pqnoeRyPzNdIAsomJE3hSyKQgHM1zNX9egbadGCEMuzEn/yyOhFtylxb1exD',
      '1laZ4GsrCgYFWwIDAQABo3sweTAJBgNVHRMEAjAAMCwGCWCGSAGG+EIBDQQfFh1P',
      'cGVuU1NMIEdlbmVyYXRlZCBDZXJ0aWZpY2F0ZTAdBgNVHQ4EFgQUJZhyauckNAHu',
      'WR3Ob1Pke5Az6IowHwYDVR0jBBgwFoAUpyEqyXE+yqEUWQrjSvcdD9HC9G8wDQYJ',
      'KoZIhvcNAQELBQADggIBALhzMOzZi4GN7gufEZdXWGXlH4hI+uF4h2EYW8hbOvjX',
      'YUlu4qYVQmeRe7kBfOnb2k2/5nFfOeOh0UCBsnFPUidT47AyIABvJ84MQOYAVwkh',
      'BgCsQIDScoIEvmDNWbLvckT4QuutPac7C3GH7nd+tyhgm2LDuPEKW9vCP2KwJ2Ik',
      'h4vNpVrB1cjqDoXmRE8yAST2K3EU/ILD269pybAKx9l1JOsYrpyjX9R//sIpVb2f',
      'Zkx+tbSial5cxQWJTEJ1gypwKqvU61xIwJqkCO+CQSPMLDMSrUfR6Mk8z0gZBPBu',
      'PzCpT3QaDPl9RAlMy5QCRSeT7Flcyx1q+AHZIbEIK9kwLMH6uYg0DKsev6LNPo1f',
      'JqTG0A5i6YwjSrNFAVdfn66tNl933IRqQVSYvt5BGXz6Uenlcs9P4z2on6Qwu/8m',
      'L1MSw/FazNOcEINi9W5QS0SZV8g0ElqcKCKi8ckgD+FERqElvMNZoNiqbjt/tY/4',
      'JCsmAY8dZhmqBcsV3C+tS7yxNthuVMdVBet15DoPBdoFERiQ4DsaS4zJ4TUkC0Ue',
      'A+FQlhFH5/dQe8dJ+Pmq5D+Z4q5vmggtRUBwPm6fZ3byCHZLuEPnqy9OmIdzjoaB',
      'U7hSi/hWVpSVN+jOra0QwrLox4uThSfyWTrPrt6YSYfopLdJoh8FiLo134EmnYj4',
      '-----END CERTIFICATE-----',
      '',
    ], "\n"),
    tag     => 'SSLCert',
  }
  file { 'CA Cert':
    ensure  => file,
    path    => "${sslCertsDir}/ca.pem",
    owner   => $owner,
    group   => $owner,
    mode    => '0644',
    content => join([
      '-----BEGIN CERTIFICATE-----',
      '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',
      '-----END CERTIFICATE-----',
      '',
    ], "\n"),
    tag     => 'SSLCert',
  }

  # Keys
  if $incForemanKey {
    file { 'Foreman Key':
      ensure  => file,
      path    => "${sslPrivateKeysDir}/foreman.example.net.pem",
      owner   => $owner,
      group   => $owner,
      mode    => '0600',
      content => join([
        '-----BEGIN RSA PRIVATE KEY-----',
        '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',
        '-----END RSA PRIVATE KEY-----',
        '',
      ], "\n"),
      tag     => 'SSLCert',
    }
  }
  if $incPuppetKey {
    file { 'Puppet Key':
      ensure  => file,
      path    => "${sslPrivateKeysDir}/puppet.example.net.pem",
      owner   => $owner,
      group   => $owner,
      mode    => '0600',
      content => join([
        '-----BEGIN RSA PRIVATE KEY-----',
        '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',
        '-----END RSA PRIVATE KEY-----',
        '',
      ], "\n"),
      tag     => 'SSLCert',
    }
  }
  if $incRootCAKey {
    file { 'CA Key':
      ensure  => file,
      path    => "${sslPrivateKeysDir}/ca.pem",
      owner   => $owner,
      group   => $owner,
      mode    => '0640',
      content => join([
        '-----BEGIN RSA PRIVATE KEY-----',
        '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',
        '-----END RSA PRIVATE KEY-----',
        '',
      ], "\n"),
      tag     => 'SSLCert',
    }
  }

  if $incCRL {
    file { 'CA CRL':
      ensure  => file,
      path    => "${sslDir}/crl.pem",
      owner   => $owner,
      group   => $owner,
      mode    => '0644',
      replace => false,
      content => join([
        '-----BEGIN X509 CRL-----',
        'MIICvzCBqDANBgkqhkiG9w0BAQsFADB5MQswCQYDVQQGEwJVUzETMBEGA1UECAwK',
        'V2FzaGluZ3RvbjEQMA4GA1UEBwwHU2VhdHRsZTEcMBoGA1UECgwTSnVuZ2xlIENh',
        'dCBTb2Z0d2FyZTElMCMGA1UEAwwcRXhhbXBsZSBGb3JlbWFuIFJvb3QgQ0EgQ2Vy',
        'dBcNMTYwNTI4MTcyMjQyWhcNMTYwNjI3MTcyMjQyWjANBgkqhkiG9w0BAQsFAAOC',
        'AgEAIguk6roh4EXQOzUlGg+haCpdW4BpKZlz37ClrTHn+Nb8XTBjGAMdSH7dkryo',
        'kXzJBW855QzizdhGWDaOfaYIPxY0Ja2DEp7DgCs6q39FpUq8szGjHC6mxENNdDyN',
        'gfoQn3wpi1Hcrx1tg2x+GF1dA2j+I519YkVbw3wlecBa0WNCeu1i04wOwfnAPQ/k',
        'i/1APMqByQWBQMrrjvMlr7J6VMeJqppD4B/GkIhKFqsKsVzZtJ3eI+80JZZXPeTl',
        'Iqs7LbIWooa1Bh8Ljf1UYFtXZv56SlpICNzt77REErj6scvxPcBsLd+kFVRXnEQ1',
        'AlBo2wr66h605NvpuyS9nBlq5IqQaOiU1dc1l21sWsoG3GPH+k/utgrrNNHliiH5',
        'LmePLhJ/lAVT4zlSemHejcIF+498d3tNuPfUIndo68QzpwM3hUyK5/iQ5ismf5Xg',
        'e4DG1coL6KUAZoyhXGze/zRIFezLTP+Ot4OPkwEB7lKZ1kEA5gic5c4/pgbH9sfk',
        'QRifrTNxoyEPnzLND8vRhBwTLoYPsOC+Ts8VvLf190f/dS7zgf5a8bYQYmaa3KLu',
        'isx3Q4dKiTswC5/yRvS5jg5AcJA/yYvlrUPv2hpnvAAT/ui4GaErRt8GHPd9WRBP',
        'f5DqiyOxWK71Ey6HMIlbzKjdA6JOhRDlaWxL83DR52bxWv8=',
        '-----END X509 CRL-----',
        '',
      ], "\n"),
      tag     => 'SSLCert',
    }
  }


  User[$owner] ->
  File<| owner == $owner |>

  File<| tag == 'SSLCert' |> ~>
  Service[$foremanService]
}
